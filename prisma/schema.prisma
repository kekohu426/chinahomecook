// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ==================== é£Ÿè°±æ•°æ®æ¨¡å‹ ====================
// ğŸš¨ é‡è¦ï¼šä¸¥æ ¼éµå¾ª PRD Schema v1.1.0
// å‚è€ƒæ–‡æ¡£ï¼šdocs/SCHEMA_VALIDATION.md

model Recipe {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Schemaç‰ˆæœ¬ï¼ˆå¿…å¡«ï¼‰
  schemaVersion String   @default("1.1.0")

  // æ ‡é¢˜ï¼ˆå¿…å¡«ï¼‰
  titleZh       String   // ä¸­æ–‡æ ‡é¢˜
  titleEn       String?  // è‹±æ–‡æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰

  // æ‘˜è¦ä¿¡æ¯ï¼ˆJSONBå­˜å‚¨ï¼ŒPRD v1.1.0ï¼‰
  // { oneLine, healingTone, difficulty, timeTotalMin, timeActiveMin, servings }
  summary       Json

  // æ–‡åŒ–æ•…äº‹ï¼ˆJSONBå­˜å‚¨ï¼ŒPRD v1.1.0ï¼‰
  // { title, content, tags[] }
  story         Json

  // é£Ÿææ¸…å•ï¼ˆJSONBå­˜å‚¨ï¼ŒPRD v1.1.0ï¼‰
  // [{ section, items: [{ name, iconKey, amount, unit, notes? }] }]
  ingredients   Json

  // åˆ¶ä½œæ­¥éª¤ï¼ˆJSONBå­˜å‚¨ï¼ŒPRD v1.1.0ï¼‰
  // [{ id, title, action, speechText, timerSec, visualCue, failPoint, photoBrief }]
  steps         Json

  // é£æ ¼æŒ‡å—ï¼ˆJSONBå­˜å‚¨ï¼ŒPRD v1.1.0ï¼‰
  // { theme, lighting, composition, aesthetic }
  styleGuide    Json

  // é…å›¾æ–¹æ¡ˆï¼ˆJSONBå­˜å‚¨ï¼ŒPRD v1.1.0ï¼‰
  // [{ key, imagePrompt, ratio }]
  imageShots    Json

  // ç­›é€‰å’Œæœç´¢å­—æ®µï¼ˆæ‰©å±•å­—æ®µï¼Œä¸åœ¨PRDä¸­ï¼‰
  location        String?   // åœ°ç‚¹ï¼ˆå·æ¸ã€æ±Ÿæµ™ã€ç²¤æ¸¯æ¾³ç­‰ï¼‰
  cuisine         String?   // èœç³»ï¼ˆå·èœã€ç²¤èœã€æ¹˜èœç­‰ï¼‰
  mainIngredients String[]  // ä¸»è¦é£Ÿææ•°ç»„ï¼ˆç”¨äºç­›é€‰ï¼‰
  slug            String    @unique // URLå‹å¥½æ ‡è¯†
  coverImage      String?   // å°é¢å›¾URL
  aiGenerated     Boolean   @default(false) // æ˜¯å¦AIç”Ÿæˆ

  // å…ƒæ•°æ®ï¼ˆæ‰©å±•å­—æ®µï¼Œä¸åœ¨PRDä¸­ï¼‰
  author        String?
  isPublished   Boolean  @default(false)
  viewCount     Int      @default(0)

  @@index([titleZh])
  @@index([isPublished])
  @@index([createdAt])
  @@index([location])
  @@index([cuisine])
  @@index([mainIngredients])
  @@index([slug])
  @@index([aiGenerated])
}

// ==================== ç”¨æˆ·æ¨¡å‹ ====================

model User {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  email         String   @unique
  passwordHash  String
  name          String?

  role          Role     @default(USER)

  @@index([email])
}

enum Role {
  USER
  ADMIN
}

// ==================== AIå¯¹è¯å†å² ====================

model AIConversation {
  id            String   @id @default(cuid())
  createdAt     DateTime @default(now())

  recipeId      String
  recipeTitleZh String   // å†—ä½™å­—æ®µï¼Œæ–¹ä¾¿æŸ¥è¯¢

  messages      Json     // [{ role, content, timestamp }]

  @@index([recipeId])
  @@index([createdAt])
}

// ==================== é…ç½®è¡¨ï¼ˆåœ°ç‚¹ã€èœç³»ç®¡ç†ï¼‰====================

model Location {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  name        String   @unique // åœ°ç‚¹åç§°ï¼ˆå·æ¸ã€æ±Ÿæµ™ã€ç²¤æ¸¯æ¾³ç­‰ï¼‰
  description String?          // æè¿°
  slug        String   @unique // URLå‹å¥½æ ‡è¯†
  isActive    Boolean  @default(true) // æ˜¯å¦å¯ç”¨
  sortOrder   Int      @default(0)    // æ’åº

  @@index([isActive])
  @@index([sortOrder])
}

model Cuisine {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  name        String   @unique // èœç³»åç§°ï¼ˆå·èœã€ç²¤èœã€æ¹˜èœç­‰ï¼‰
  description String?          // æè¿°
  slug        String   @unique // URLå‹å¥½æ ‡è¯†
  isActive    Boolean  @default(true) // æ˜¯å¦å¯ç”¨
  sortOrder   Int      @default(0)    // æ’åº

  @@index([isActive])
  @@index([sortOrder])
}
