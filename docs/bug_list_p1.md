## P1 阶段缺陷清单（代码审查输出）

日期：2026-01-10  
来源：P1 基础框架代码审查（docs/code_review_p1.md）

### 严重
1) 范围漂移 / 误删文档与资源  
   - 现象：本次提交中删除/改动大量无关文件（如 docs/PLAN.md、docs/TEST_PLAN.md、docs/prd-images/* 等）以及多个非合集相关的 API/UI。  
   - 风险：文档/资源缺失、现有功能回归。  
   - 动作：撤销无关改动或拆分为独立变更；恢复被误删文件。

2) 数据库迁移缺失  
   - 现象：`prisma/schema.prisma` 已扩展 Collection 字段/索引，但未附带 Prisma migrate/SQL 迁移说明。  
   - 风险：环境无法应用 schema，导致运行/部署失败。  
   - 动作：补充迁移脚本和执行说明（含回滚方案）。

### 中
3) 缺乏测试验证  
   - 现象：新增/重写 `lib/types/collection*.ts`、`app/api/admin/collections/*` 无单测或集成测试报告。  
   - 风险：规则口径、达标判定、置顶/排除、列表/发布等核心逻辑缺乏保障。  
   - 动作：补充至少规则引擎、达标口径、列表/详情/发布/置顶/排除 API 的单测/集成测试，并提供执行命令与输出。

### 低
4) 其他待核实项  
   - 需核对是否存在未声明的 breaking change 或兼容性问题；后续验证时一并覆盖。
