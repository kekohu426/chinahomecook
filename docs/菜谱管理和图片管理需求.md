第一部分:菜谱状态管理

1.1 菜谱生命周期

4个核心状态







状态



英文



说明



谁可以操作





草稿



draft



AI刚生成或手动创建，内容未完成



系统自动/内容编辑





待审核



review



内容完整，等待人工审核



内容编辑提交





已发布



published



审核通过，用户可见



运营人员审核通过





已归档



archived



下线或过期，用户不可见



运营人员/系统自动

状态转换条件

┌─────────┐
│  draft  │ AI生成或手动创建
└────┬────┘
     │ 内容完成 + 提交审核
     ↓
┌─────────┐
│  review │ 等待人工审核
└────┬────┘
     │
     ├─→ [审核通过] ─→ published
     │
     └─→ [审核拒绝] ─→ draft (退回修改)

┌───────────┐
│ published │ 已发布，自动归入聚合页
└─────┬─────┘
      │
      ├─→ [手动下线] ─→ archived
      │
      └─→ [内容过期/质量差] ─→ archived

自动转换规则

draft → review (自动)





触发条件:





必须有标题



必须有至少1个食材



必须有至少3个步骤



成品图3张必须全部生成成功



至少打了3个标签



不满足条件:无法提交审核，显示缺失项提示

review → published (人工)





运营人员在审核工作台操作



审核通过后:





状态改为published



自动归入所有匹配的聚合页



更新聚合页统计



提交sitemap

published → archived (自动/手动)





自动归档条件:





浏览量持续低于阈值(如30天<10次浏览)



AI质量评分<3分



手动归档:





运营人员主动下线



内容过期或不再适用

1.2 菜谱列表管理

功能目标

为运营人员提供统一的菜谱管理入口，支持快速查找、筛选和批量操作。

页面路径:/admin/recipes

界面原型

┌──────────────────────────────────────────────────────────┐
│  📝 菜谱管理                                              │
│  [+ 手动创建菜谱]  [AI批量生成]                          │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  筛选工具栏:                                              │
│  ├─ 状态: [全部 ▼] [草稿] [待审核] [已发布] [已归档]     │
│  ├─ 标签: [选择标签...▼] (多选)                          │
│  ├─ 创建时间: [最近7天 ▼]                                │
│  └─ 搜索: [输入菜名或ID________] [搜索]                  │
│                                                          │
│  [清空筛选]  [导出结果]                                   │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  批量操作: ☐ 全选  已选: 0                                │
│  [批量打标签] [批量审核] [批量归档] [批量删除]            │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  菜谱列表 (表格展示)                                       │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  ☐  [缩略图]  标题           状态    标签    创建时间 操作│
│  ─────────────────────────────────────────────────────── │
│  ☐  [图]  宫保鸡丁       已发布  川菜+3  1小时前  [编辑] │
│                                   128次浏览    [预览]    │
│                                                [归档]    │
│  ☐  [图]  清蒸鲈鱼       待审核  粤菜+2  2小时前  [审核] │
│                                   AI质量4.2分  [编辑]    │
│  ☐  [图]  麻婆豆腐       草稿    川菜+1  3小时前  [编辑] │
│                                   ⚠️ 缺步骤图   [删除]    │
│                                                          │
│  [显示更多...]                                            │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  分页: 共328个菜谱                                        │
│  <  1  2  3  4  5  ...  33  >                            │
└──────────────────────────────────────────────────────────┘

核心功能说明

1. 筛选功能





按状态筛选:快速切换查看不同状态的菜谱



按标签筛选:可多选标签(如:川菜+麻辣+快手菜)



按时间筛选:今天、最近7天、最近30天、自定义日期范围



搜索功能:支持菜名、ID、食材关键词搜索

2. 批量操作





批量打标签:勾选多个菜谱，统一添加某个标签



批量审核:快速通过或拒绝多个待审核菜谱



批量归档:将多个已发布菜谱下线



批量删除:删除草稿状态的菜谱(已发布的不可删除，只能归档)

3. 列表展示信息





缩略图:成品主图(cover_main)的缩略版



标题:菜谱中文名称



状态标签:不同颜色标识不同状态





草稿:灰色



待审核:橙色



已发布:绿色



已归档:深灰色



标签显示:显示前2个标签+数字(如:"川菜+3"表示还有3个标签)



统计数据:





已发布:显示浏览量



待审核:显示AI质量评分



草稿:显示缺失项警告



快速操作按钮:





编辑:跳转到编辑页



预览:在新窗口查看前台展示效果



审核:进入审核界面



归档:确认后下线

成功标准





✅ 可以快速查看所有菜谱



✅ 筛选功能准确，响应速度快(≤1秒)



✅ 批量操作稳定，支持一次操作50+菜谱



✅ 搜索功能支持模糊匹配

1.3 菜谱编辑功能

功能目标

提供完整的菜谱内容编辑能力，支持修改AI生成的内容，补充缺失信息，打标签。

页面路径:/admin/recipes/[id]/edit

Tab结构(基于已有设计)

6个Tab页:





基本信息:标题、slug、摘要、文化故事



食材:食材列表管理(分组、数量、单位、预处理)



步骤:烹饪步骤管理(动作、火候、时间、状态检查)



故事:文化故事、烹饪小贴士、失败排查



图片:所有图片管理(成品图、步骤图、食材图) ← 本次重点设计



营养:营养成分、饮食标签、相关推荐

打标签界面(所有Tab都可见)

位置:页面右侧侧边栏或顶部固定区域

┌────────────────────────────────┐
│  🏷️ 标签管理                   │
├────────────────────────────────┤
│                                │
│  菜系: (可选1个)                │
│  [ ] 川菜  [ ] 粤菜  [ ] 湘菜  │
│  [ ] 苏菜  [显示更多...]        │
│                                │
│  区域: (可选1个)                │
│  [ ] 四川  [ ] 广东  [ ] 湖南  │
│  [显示更多...]                  │
│                                │
│  适宜人群: (可多选)             │
│  [x] 糖尿病  [ ] 孕妇  [ ] 儿童│
│  [x] 老人    [显示更多...]     │
│                                │
│  场合: (可多选)                 │
│  [x] 家常菜  [x] 养生菜        │
│  [ ] 宴客菜  [显示更多...]     │
│                                │
│  用餐场景: (可多选)             │
│  [x] 午餐  [x] 晚餐  [ ] 早餐  │
│                                │
│  烹饪方法: (可选1个)            │
│  [x] 蒸  [ ] 炒  [ ] 炖        │
│                                │
│  口味: (可多选)                 │
│  [x] 清淡  [ ] 麻辣  [ ] 咸鲜  │
│                                │
│  烹饪难度: (可选1个)            │
│  [ ] 新手  [x] 进阶  [ ] 大厨  │
│                                │
│  用时: (可选1个)                │
│  [x] ≤30分钟  [ ] ≤60分钟     │
│                                │
│  已选标签: 8个                  │
│  [清空所有标签]                │
└────────────────────────────────┘

打标签交互逻辑

展示方式:





按9个标签分类分组展示



默认展示每个分类的前3-5个常用标签



点击"显示更多"展开该分类的全部标签



已选标签用不同颜色高亮显示

多选规则:





菜系、区域、烹饪方法、烹饪难度、用时:单选(一个菜谱只能属于一个)



适宜人群、场合、用餐场景、口味:多选(一个菜谱可以有多个)

自动保存:





勾选/取消标签后自动保存



实时显示"已选标签:X个"



标签变更后，相关聚合页自动更新

保存和发布逻辑

保存草稿:





任何状态都可以点击"保存"按钮



保存当前Tab的修改内容



状态保持不变

提交审核:





草稿状态可以点击"提交审核"按钮



系统检查必需项:





✅ 标题不为空



✅ 食材列表至少1项



✅ 烹饪步骤至少3步



✅ 成品图3张全部生成成功



✅ 至少打了3个标签



检查通过:状态改为review



检查失败:显示缺失项清单，无法提交

直接发布(权限控制):





超级管理员可以跳过审核直接发布



点击"直接发布"按钮:





状态改为published



自动归入所有匹配的聚合页



提交sitemap

撤回到草稿:





review状态可以"撤回到草稿"



published状态可以"取消发布"(状态回到draft)



第二部分:图片管理系统

2.1 图片类型定义

基于菜谱提示词文档的图片结构

一个完整菜谱包含的图片:







图片类型



数量



Key命名规则



比例



用途





成品主图



1张



cover_main



16:9



俯拍全景，展示整道菜





成品特写



1张



cover_detail



16:9



侧面或45度角，展示质感





成品内部



1张



cover_inside



16:9



切开内部，展示结构





食材平铺图



1张



ingredients



3:2



所有食材整齐摆放





步骤图



N张



step_{序号}



4:3



每步操作的真实场景

示例:清蒸鲈鱼的图片清单

├─ cover_main (成品俯拍)
├─ cover_detail (成品侧面特写)
├─ cover_inside (鱼肉切开内部)
├─ ingredients (食材平铺:鲈鱼+葱姜+调料)
├─ step_01 (处理鲈鱼)
├─ step_02 (摆盘腌制)
├─ step_03 (蒸制中，冒蒸汽)
├─ step_04 (淋热油)
└─ step_05 (成品装盘)

2.2 图片生成管理(核心需求)

功能目标

让运营人员快速查看、重新生成、替换质量不佳的图片，确保所有图片符合风格要求。

页面位置:菜谱编辑页的"图片"Tab

界面原型(详细版)

┌──────────────────────────────────────────────────────────┐
│  图片管理 Tab                                             │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  📸 成品图 (3张必须)                                      │
│  ┌────────────────┐ ┌────────────────┐ ┌──────────────┐ │
│  │ [预览图]        │ │ [预览图]        │ │ [预览图]      │ │
│  │ ✅ 生成成功     │ │ ✅ 生成成功     │ │ ⚠️ 质量待确认│ │
│  │                │ │                │ │              │ │
│  │ 成品俯拍全景    │ │ 成品侧面特写    │ │ 内部结构展示  │ │
│  │ (cover_main)   │ │ (cover_detail) │ │(cover_inside)│ │
│  │                │ │                │ │              │ │
│  │ [查看prompt▼]  │ │ [查看prompt▼]  │ │[查看prompt▼]│ │
│  │ [重新生成]      │ │ [重新生成]      │ │[重新生成]    │ │
│  │ [上传替换]      │ │ [上传替换]      │ │[上传替换]    │ │
│  └────────────────┘ └────────────────┘ └──────────────┘ │
│                                                          │
│  [批量重新生成成品图]                                      │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  🥘 食材平铺图 (1张)                                      │
│  ┌────────────────┐                                      │
│  │ [预览图]        │  食材准备平铺 (ingredients)          │
│  │ ✅ 生成成功     │                                      │
│  │                │  [查看prompt▼] [重新生成] [上传替换]  │
│  └────────────────┘                                      │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  👨‍🍳 步骤图 (5张)                                         │
│  ┌────────────┐ ┌────────────┐ ┌────────────┐          │
│  │ [预览]      │ │ [预览]      │ │ [预览]      │          │
│  │ ✅         │ │ ✅         │ │ ❌ 生成失败│          │
│  │            │ │            │ │            │          │
│  │ 步骤1      │ │ 步骤2      │ │ 步骤3      │          │
│  │ 处理鲈鱼    │ │ 摆盘腌制    │ │ 蒸制中      │          │
│  │            │ │            │ │            │          │
│  │[查看▼]     │ │[查看▼]     │ │[查看▼]     │          │
│  │[重新生成]   │ │[重新生成]   │ │[重试生成]   │          │
│  │[上传替换]   │ │[上传替换]   │ │[上传替换]   │          │
│  └────────────┘ └────────────┘ └────────────┘          │
│                                                          │
│  [批量重新生成所有步骤图]                                  │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  图片生成统计                                              │
│  ├─ 总数: 9张                                            │
│  ├─ 成功: 8张 ✅                                         │
│  ├─ 失败: 1张 ❌                                         │
│  └─ 生成中: 0张 ⏳                                       │
│                                                          │
│  [全部重新生成] (慎用，消耗AI额度)                         │
└──────────────────────────────────────────────────────────┘

点击"查看prompt▼"展开后

┌────────────────────────────────────────────┐
│  成品俯拍全景 (cover_main)                  │
├────────────────────────────────────────────┤
│                                            │
│  [预览图 - 大图展示]                        │
│                                            │
│  生成状态: ✅ 成功                          │
│  生成时间: 2026-01-08 15:30:25             │
│  图片尺寸: 1920x1080 (16:9)                │
│  文件大小: 1.2MB                           │
│                                            │
│  🎨 图片Prompt:                            │
│  ┌──────────────────────────────────┐     │
│  │ 真实美食摄影，自然光，低饱和暖色调│     │
│  │ 木纹餐桌，白色亚麻桌布，浅景深，  │     │
│  │ 高清细节。主体：清蒸鲈鱼完整呈现  │     │
│  │ 在白色陶瓷椭圆盘中，鱼身表面油亮  │     │
│  │ 有光泽，葱姜丝自然散落...        │     │
│  │                              │     │
│  │ (可编辑文本框)                  │     │
│  └──────────────────────────────────┘     │
│                                            │
│  ⛔ 反向Prompt:                            │
│  ┌──────────────────────────────────┐     │
│  │ AI生成感，过度完美，塑料质感，    │     │
│  │ 不自然光影，过度锐化...          │     │
│  │ (可编辑)                         │     │
│  └──────────────────────────────────┘     │
│                                            │
│  [保存prompt修改]                          │
│  [用修改后的prompt重新生成]                │
│  [恢复默认prompt]                          │
│                                            │
│  [关闭]                                    │
└────────────────────────────────────────────┘

核心操作流程

操作1:重新生成图片(用原prompt)





点击某张图片的"重新生成"按钮



系统调用AI图片生成API，使用原来的prompt



显示生成进度(⏳ 生成中...)



生成完成:





成功:✅ 自动替换该位置的图片



失败:❌ 显示错误信息，可重试

操作2:编辑prompt后重新生成





点击"查看prompt▼"展开



修改prompt文本框内容



点击"用修改后的prompt重新生成"



生成完成后替换图片



新的prompt自动保存到菜谱数据

操作3:手动上传替换





点击"上传替换"按钮



打开文件选择器



选择图片(检查尺寸和比例)



上传成功后替换该位置的图片



标记为"手动上传"(区别于AI生成)

操作4:批量重新生成





点击"批量重新生成成品图"或"批量重新生成所有步骤图"



系统按顺序重新生成该类型的所有图片



显示整体进度条



全部完成后显示统计(成功X张，失败Y张)

2.3 图片风格统一机制

功能目标

确保所有菜谱的图片保持统一的"治愈系暖调"风格，避免风格偏移。

实现机制

1. 全局风格指南配置

位置:/admin/config/style-guide

┌──────────────────────────────────────────┐
│  🎨 图片风格指南配置                      │
├──────────────────────────────────────────┤
│                                          │
│  视觉主题:                               │
│  [治愈系暖调留白自然质感]                 │
│                                          │
│  色彩基调:                               │
│  [燕麦米] [奶油白] [陶土棕] [墨绿点缀]   │
│                                          │
│  光线设置:                               │
│  [柔和侧光/窗边自然光，弱阴影，避免硬顶光]│
│                                          │
│  材质建议:                               │
│  [原木托盘] [亚麻布] [陶瓷小碟] [深色砂锅]│
│                                          │
│  构图规则:                               │
│  - 画面留白充足，主体占比60-70%          │
│  - 统一桌面材质与餐具风格                 │
│  - 步骤图优先展示状态信号                 │
│  - 避免文字水印与夸张滤镜                 │
│                                          │
│  [保存风格指南]                           │
│  [应用到所有菜谱] (重新生成所有图片)      │
└──────────────────────────────────────────┘

2. Prompt自动继承





所有图片生成时，自动在prompt前加上全局风格指南



格式:

{全局风格指南} + {该图片的具体描述}

3. 风格一致性检查(AI辅助)





AI生成图片后，调用AI视觉检查API



检查是否符合风格指南:





色调是否为暖色系



是否有过度饱和或塑料感



光线是否自然



不符合的图片标记为"⚠️ 风格待确认"

2.4 图片质量检查

生成状态显示

4种状态:







状态



图标



说明



可操作





生成成功



✅



图片已生成，可正常使用



重新生成/上传替换





生成中



⏳



正在调用AI生成



等待(可取消)





生成失败



❌



AI调用失败或超时



重试生成/上传替换





风格待确认



⚠️



生成成功但风格检查未通过



重新生成/确认使用

失败信息展示

┌────────────────────────────────────┐
│  [X] 步骤3图片                      │
│  ❌ 生成失败                        │
│                                    │
│  错误原因:                         │
│  API超时(30秒)                     │
│                                    │
│  [查看完整错误日志]                 │
│  [立即重试] [修改prompt后重试]      │
│  [跳过此图片] [上传替换]            │
└────────────────────────────────────┘

批量质量检查

┌──────────────────────────────────────┐
│  图片质量诊断                         │
├──────────────────────────────────────┤
│                                      │
│  📊 诊断结果:                        │
│  ├─ ✅ 完整率: 100% (9/9张)          │
│  ├─ ⚠️ 风格一致性: 88% (1张待确认)  │
│  ├─ ❌ 失败率: 0%                    │
│  └─ 📏 尺寸合规: 100%                │
│                                      │
│  待处理问题:                         │
│  └─ ⚠️ cover_inside风格偏冷色调     │
│      建议重新生成                    │
│      [查看详情] [一键修复]           │
│                                      │
│  [开始全面检查] [导出报告]           │
└──────────────────────────────────────┘



第三部分:与AI生成的集成

3.1 AI生成菜谱时的图片处理

完整流程

Step 1: AI生成菜谱内容
  ├─ 生成标题、食材、步骤等文字内容
  ├─ 生成每个步骤的photoBrief和imagePrompt
  └─ 状态: draft

Step 2: 自动生成所有图片(异步)
  ├─ 创建图片生成任务队列
  │   ├─ 任务1: cover_main
  │   ├─ 任务2: cover_detail
  │   ├─ 任务3: cover_inside
  │   ├─ 任务4: ingredients
  │   └─ 任务5-N: 各步骤图
  │
  ├─ 按顺序调用AI图片生成API
  │   └─ 每张图片独立生成，不阻塞
  │
  └─ 实时更新生成状态

Step 3: 图片生成完成
  ├─ 全部成功 → 菜谱可提交审核
  ├─ 部分失败 → 标记失败项，允许重试
  └─ 全部失败 → 提示检查AI配置

生成状态同步

在菜谱列表页实时显示:

宫保鸡丁
├─ 状态: draft
├─ 图片: ⏳ 生成中 (3/9张已完成)
└─ 预计完成: 约5分钟

在菜谱编辑页实时刷新:





每张图片的状态独立更新



生成完成的图片立即显示



不需要刷新整个页面

3.2 图片生成队列

功能目标

处理大量图片生成任务，避免超时和失败，支持断点续传。

队列管理界面

位置:/admin/image-queue (可选，或在仪表盘展示)

┌──────────────────────────────────────────────┐
│  📸 图片生成队列                              │
├──────────────────────────────────────────────┤
│                                              │
│  当前状态:                                   │
│  ├─ 队列中: 23个任务                         │
│  ├─ 生成中: 3个任务                          │
│  └─ 预计完成: 约15分钟                       │
│                                              │
│  ┌────────────────────────────────────┐     │
│  │ 任务1: 清蒸鲈鱼 - cover_main       │     │
│  │ ⏳ 生成中... 已用时12秒             │     │
│  │ [取消任务]                         │     │
│  ├────────────────────────────────────┤     │
│  │ 任务2: 宫保鸡丁 - step_03          │     │
│  │ ✅ 完成 (用时8秒)                  │     │
│  ├────────────────────────────────────┤     │
│  │ 任务3: 麻婆豆腐 - cover_detail     │     │
│  │ ⏳ 排队中 (前面还有2个任务)        │     │
│  └────────────────────────────────────┘     │
│                                              │
│  失败任务 (3个):                             │
│  └─ 红烧肉 - cover_inside                   │
│      错误: API超时                           │
│      [重试] [查看详情] [跳过]                │
│                                              │
└──────────────────────────────────────────────┘

队列处理逻辑

优先级规则:





P0 - 最高优先级:待审核菜谱的失败图片(阻碍发布)



P1 - 高优先级:新生成菜谱的初始图片



P2 - 普通优先级:运营人员手动重新生成的图片

并发控制:





同时最多生成3张图片(避免API限流)



单张图片超时时间:30秒



失败自动重试:最多3次

断点续传:





生成过程中关闭页面，队列继续执行



下次打开时，显示最新进度



已完成的图片不会重复生成



第四部分:界面原型

4.1 菜谱列表页完整原型

页面路径:/admin/recipes

界面结构(完整版)

┌──────────────────────────────────────────────────────────┐
│  Header: Recipe Zen 后台管理                              │
│  [仪表盘] [菜谱管理] [合集管理] [标签管理] [配置]         │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  📝 菜谱管理                           [用户头像 ▼]       │
│  ┌────────────────────────────────────────────────┐      │
│  │ [+ 手动创建菜谱]  [AI批量生成]                 │      │
│  └────────────────────────────────────────────────┘      │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  📊 数据概览                                              │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │
│  │ 总数     │ │ 草稿     │ │ 待审核   │ │ 已发布   │   │
│  │ 328      │ │ 45       │ │ 23       │ │ 260      │   │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  🔍 筛选与搜索                                            │
│  ┌────────────────────────────────────────────────┐      │
│  │ 状态: [全部 ▼]  标签: [选择...▼]  时间:[最近7天▼]│   │
│  │ 搜索: [输入菜名、ID或食材________________] [🔍]  │   │
│  │ [清空筛选]  [保存筛选条件]                      │   │
│  └────────────────────────────────────────────────┘      │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  ✅ 批量操作                                              │
│  ┌────────────────────────────────────────────────┐      │
│  │ ☐ 全选  已选: 0  [取消选择]                    │      │
│  │ [批量打标签] [批量审核] [批量归档] [批量删除]   │      │
│  └────────────────────────────────────────────────┘      │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  📋 菜谱列表 (表格视图)                                   │
│  排序: [创建时间↓]                                        │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  ☐  [图]  标题           状态   标签      数据    操作   │
│  ────────────────────────────────────────────────────── │
│  ☐  [🖼️]  宫保鸡丁       🟢已发布  川菜+3   128次   [...▼]│
│           Gongbao Jiding           麻辣+2   4.5分        │
│                                    1小时前               │
│  ────────────────────────────────────────────────────── │
│  ☐  [🖼️]  清蒸鲈鱼       🟡待审核  粤菜+2   0次    [...▼]│
│           Steamed Bass             清淡     4.2分        │
│                                    2小时前  ⚠️1张图失败   │
│  ────────────────────────────────────────────────────── │
│  ☐  [📄]  麻婆豆腐       ⚪草稿    川菜+1   -       [...▼]│
│           Mapo Tofu               麻辣     -            │
│                                   3小时前  ⚠️缺步骤图    │
│  ────────────────────────────────────────────────────── │
│                                                          │
│  [加载更多...]                                            │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  分页: 显示 1-20 / 共328个                                │
│  [每页显示: 20 ▼]  < 上一页  1 2 3 ... 17  下一页 >     │
└──────────────────────────────────────────────────────────┘

操作菜单([...▼])展开后

┌────────────────┐
│ [预览前台]      │
│ [编辑]          │
│ [复制]          │
│ ────────────── │
│ [审核](待审核时)│
│ [提交审核](草稿)│
│ [撤回](待审核时)│
│ ────────────── │
│ [归档]          │
│ [删除](草稿时)  │
└────────────────┘

4.2 菜谱编辑页 - 图片Tab完整原型

页面路径:/admin/recipes/[id]/edit - 图片Tab

界面布局(完整版)

┌──────────────────────────────────────────────────────────┐
│  编辑菜谱: 清蒸鲈鱼                          [保存] [关闭]│
│  ┌────────────────────────────────────────────────┐      │
│  │ [基本信息] [食材] [步骤] [故事] [图片] [营养] │      │
│  │                               ▲ 当前Tab       │      │
│  └────────────────────────────────────────────────┘      │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  🏷️ 标签 (右侧固定栏)                                     │
│  ├─ 菜系: [x]粤菜                                        │
│  ├─ 适宜人群: [x]糖尿病 [x]老人                          │
│  ├─ 场合: [x]家常菜 [x]养生菜                            │
│  └─ ... (折叠显示)                                       │
│                                                          │
│  已选标签: 8个  [查看全部]                                │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  📸 图片管理 Tab                                          │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  📊 图片概览                                              │
│  ├─ 总数: 9张                                            │
│  ├─ 成功: 8张 ✅                                         │
│  ├─ 失败: 1张 ❌                                         │
│  └─ 生成中: 0张 ⏳                                       │
│                                                          │
│  [全部重新生成] [批量上传] [图片质量诊断]                 │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  🖼️ 成品图 (3张必须)                                     │
│  ┌─────────────────┐ ┌─────────────────┐ ┌────────────┐│
│  │                  │ │                  │ │            ││
│  │  [预览图 200x150]│ │  [预览图]        │ │  [预览图]  ││
│  │  ✅ 生成成功     │ │  ✅ 生成成功     │ │ ⚠️风格待确认││
│  │                  │ │                  │ │            ││
│  │ 成品俯拍全景      │ │ 成品侧面特写      │ │内部结构展示 ││
│  │ cover_main       │ │ cover_detail     │ │cover_inside││
│  │ 16:9 | 1920x1080│ │ 16:9 | 1920x1080│ │16:9|1920x1080│
│  │ 生成时间:15:30   │ │ 生成时间:15:31   │ │生成时间:15:32│
│  │                  │ │                  │ │            ││
│  │ [查看prompt▼]    │ │ [查看prompt▼]    │ │[查看prompt▼]│
│  │ [重新生成]        │ │ [重新生成]        │ │[重新生成]   ││
│  │ [上传替换]        │ │ [上传替换]        │ │[上传替换]   ││
│  │ [删除]           │ │ [删除]           │ │[确认使用]  ││
│  └─────────────────┘ └─────────────────┘ └────────────┘│
│                                                          │
│  [批量重新生成成品图(3张)]                                │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  🥘 食材平铺图 (1张)                                      │
│  ┌─────────────────┐                                    │
│  │  [预览图]        │  食材准备平铺 (ingredients)         │
│  │  ✅ 生成成功     │  3:2 | 1920x1280                   │
│  │                  │  生成时间: 15:29                   │
│  └─────────────────┘                                    │
│  [查看prompt▼] [重新生成] [上传替换]                      │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  👨‍🍳 步骤图 (5张)                                         │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐  │
│  │[预览]     │ │[预览]     │ │[预览]     │ │[预览]     │  │
│  │✅        │ │✅        │ │❌生成失败│ │✅        │  │
│  │          │ │          │ │          │ │          │  │
│  │步骤1     │ │步骤2     │ │步骤3     │ │步骤4     │  │
│  │处理鲈鱼   │ │摆盘腌制   │ │蒸制中     │ │淋热油     │  │
│  │          │ │          │ │          │ │          │  │
│  │4:3       │ │4:3       │ │4:3       │ │4:3       │  │
│  │15:33生成 │ │15:34生成 │ │⚠️超时    │ │15:36生成 │  │
│  │          │ │          │ │          │ │          │  │
│  │[查看▼]   │ │[查看▼]   │ │[查看▼]   │ │[查看▼]   │  │
│  │[重新生成] │ │[重新生成] │ │[重试生成] │ │[重新生成] │  │
│  │[上传替换] │ │[上传替换] │ │[上传替换] │ │[上传替换] │  │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘  │
│                                                          │
│  ┌──────────┐  (步骤5图片)                               │
│  │[预览]     │                                           │
│  │✅        │  步骤5: 成品装盘                           │
│  └──────────┘  [查看▼] [重新生成] [上传替换]             │
│                                                          │
│  [批量重新生成所有步骤图]                                  │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  ⚙️ 图片生成设置                                          │
│  ┌────────────────────────────────────────────────┐      │
│  │ 使用风格指南: [治愈系暖调 ▼]                    │      │
│  │ 图片生成服务商: [DALL-E 3 ▼]                    │      │
│  │ 生成质量: [标准 ▼] [高质量(消耗更多)]          │      │
│  │                                                │      │
│  │ [应用设置到全部图片]                            │      │
│  └────────────────────────────────────────────────┘      │
└──────────────────────────────────────────────────────────┘

图片卡片的交互细节

状态1: 生成成功的图片

┌─────────────────────┐
│  [预览图 - 可点击放大]│
│  ✅ 生成成功         │
│  cover_main          │
│  16:9 | 1.2MB        │
│  15:30:25生成        │
│                     │
│  [查看prompt▼]       │
│  ┌───────────────┐   │
│  │ prompt已折叠   │   │
│  └───────────────┘   │
│                     │
│  [重新生成] [上传替换]│
│  [删除](谨慎)        │
└─────────────────────┘

状态2: 生成失败的图片

┌─────────────────────┐
│  [灰色占位图]        │
│  ❌ 生成失败         │
│  step_03             │
│                     │
│  错误: API超时(30s) │
│  [查看详细错误]      │
│                     │
│  [查看prompt▼]       │
│  [重试生成]          │
│  [编辑prompt后重试]  │
│  [上传替换]          │
│  [跳过此图片]        │
└─────────────────────┘

状态3: 生成中的图片

┌─────────────────────┐
│  [加载动画]          │
│  ⏳ 生成中...        │
│  cover_detail        │
│                     │
│  已用时: 12秒        │
│  预计还需: 约8秒     │
│                     │
│  [取消生成]          │
└─────────────────────┘

Prompt展开后的界面

┌────────────────────────────────────────────┐
│  [查看prompt▲] (点击收起)                   │
├────────────────────────────────────────────┤
│                                            │
│  🎨 图片生成Prompt:                        │
│  ┌──────────────────────────────────┐     │
│  │ 真实美食摄影，自然光，低饱和暖色调│     │
│  │ 木纹餐桌，白色亚麻桌布，浅景深，  │     │
│  │ 高清细节。主体：清蒸鲈鱼完整呈现  │     │
│  │ 在白色陶瓷椭圆盘中，鱼身表面油亮  │     │
│  │ 有光泽，葱姜丝自然散落，微微冒蒸汽│     │
│  │ （真实水汽效果，不过度），旁边小碟│     │
│  │ 装蒸鱼豉油，竹筷子自然摆放。俯拍  │     │
│  │ 角度，留白充足，背景虚化...      │     │
│  │                              │     │
│  │ (可编辑文本框，约300-500字)    │     │
│  └──────────────────────────────────┘     │
│                                            │
│  ⛔ 反向Prompt (排除要素):                 │
│  ┌──────────────────────────────────┐     │
│  │ AI生成感，过度完美，塑料质感，    │     │
│  │ 不自然光影，过度锐化，磨皮效果... │     │
│  │                              │     │
│  │ (可编辑文本框)                  │     │
│  └──────────────────────────────────┘     │
│                                            │
│  [保存prompt修改]                          │
│  [用修改后的prompt重新生成]                │
│  [恢复默认prompt] (从风格指南重新生成)     │
│  [取消修改]                                │
└────────────────────────────────────────────┘

操作流程说明

流程1: 重新生成图片





发现某张图片质量不好(如:光线太暗、构图不好)



点击该图片的"重新生成"按钮



弹窗确认:"使用原prompt重新生成该图片?"



确认后:





该图片卡片显示⏳生成中状态



显示生成进度(已用时XX秒)



其他图片不受影响，可继续操作



生成完成:





成功:自动替换预览图，显示✅



失败:显示错误信息，提供重试按钮

流程2: 编辑prompt后重新生成





点击"查看prompt▼"展开prompt内容



修改prompt文本框(如:改"俯拍"为"45度侧拍")



点击"用修改后的prompt重新生成"



系统使用新prompt调用AI API



生成完成后:





新图片替换旧图片



新prompt保存到菜谱数据(覆盖旧prompt)



下次重新生成使用新prompt

流程3: 手动上传替换





点击"上传替换"按钮



打开文件选择器



选择本地图片文件



系统检查图片:





格式:jpg/png/webp



尺寸:根据图片类型检查比例





成品图:16:9



步骤图:4:3



食材图:3:2



大小:≤5MB



检查通过:





上传到CDN



替换该位置的图片



标记来源为"手动上传"



检查失败:





显示错误提示(如:"尺寸不符合16:9比例")



提供图片裁剪工具或重新选择

流程4: 批量重新生成





点击"批量重新生成成品图(3张)"



弹窗确认:"将重新生成3张成品图，消耗AI额度，确认?"



确认后:





3张成品图卡片都显示⏳生成中



显示整体进度条:"正在生成 1/3..."



按顺序生成(避免并发过多)



全部完成:





显示统计:"成功2张，失败1张"



失败的图片显示错误信息和重试按钮



第五部分:特殊场景处理

5.1 图片生成全部失败的处理

场景描述

AI生成菜谱后，图片生成任务全部失败(如:AI服务故障、额度用尽、网络问题)

处理方式

┌────────────────────────────────────────┐
│  ⚠️ 图片生成失败                        │
├────────────────────────────────────────┤
│                                        │
│  该菜谱的所有图片生成均失败。          │
│                                        │
│  可能原因:                             │
│  - AI图片服务暂时不可用                │
│  - API额度已用尽                       │
│  - 网络连接问题                         │
│                                        │
│  建议操作:                             │
│  1. 检查AI配置 (/admin/config/ai)      │
│  2. 稍后重试生成                        │
│  3. 或手动上传图片                      │
│                                        │
│  [检查AI配置]                           │
│  [全部重新生成] (稍后重试)              │
│  [保存为草稿] (暂不处理图片)            │
│  [删除此菜谱]                           │
└────────────────────────────────────────┘

状态标记





菜谱状态:draft



在列表页显示:⚠️ 缺少图片



不允许提交审核(图片是必需项)

5.2 图片风格不一致的处理

场景描述

某张图片的风格与整体风格指南不符(如:过于鲜艳、塑料感、光线不自然)

AI风格检查(自动)

生成完成后自动执行:

1. 调用AI视觉检查API
2. 输入:
   - 生成的图片
   - 全局风格指南
3. AI判断:
   - 色调是否为低饱和暖色系
   - 是否有塑料质感或AI痕迹
   - 光线是否自然柔和
4. 输出:
   - 符合度评分(0-100分)
   - 不符合的具体问题
5. 处理:
   - 评分≥80分:✅ 通过
   - 评分<80分:⚠️ 风格待确认

人工确认界面

┌────────────────────────────────────────┐
│  cover_inside                          │
│  ⚠️ 风格待确认 (AI评分: 65分)          │
├────────────────────────────────────────┤
│                                        │
│  [预览图]                               │
│                                        │
│  AI检测到的问题:                        │
│  - 色彩饱和度偏高(89%)，建议≤70%       │
│  - 光线偏硬，缺少柔和感                 │
│  - 背景有轻微杂乱元素                   │
│                                        │
│  你的决定:                             │
│  ( ) 确认使用 (人工判断可接受)         │
│  (•) 重新生成 (自动优化问题)           │
│  ( ) 上传替换 (手动提供图片)           │
│                                        │
│  [确定]  [取消]                        │
└────────────────────────────────────────┘

5.3 步骤图数量动态变化

场景描述

编辑步骤时，增加或删除了步骤，对应的步骤图需要同步

处理逻辑

增加步骤:

1. 在"步骤"Tab中添加了新步骤(如:步骤6)
2. 系统检测到步骤数量变化
3. 在"图片"Tab中:
   - 自动新增一个步骤图位置
   - 状态:⚪ 未生成
   - 显示:[生成此步骤图]按钮
4. 点击按钮:
   - 根据步骤内容自动生成imagePrompt
   - 调用AI API生成图片

删除步骤:

1. 在"步骤"Tab中删除了步骤3
2. 弹窗确认:"删除步骤3会同时删除对应的步骤图，确认?"
3. 确认后:
   - 步骤图3从列表中移除
   - 后续步骤图重新编号(步骤4→步骤3，步骤5→步骤4...)
   - 图片文件标记为"待清理"(定期任务删除)



第六部分:成功标准与验收

6.1 菜谱管理验收标准

列表页:





✅ 可以查看所有菜谱(支持分页，每页20-50条)



✅ 筛选功能准确，响应时间≤1秒



✅ 搜索支持模糊匹配，结果准确



✅ 批量操作稳定，一次可操作50+菜谱

编辑页:





✅ 6个Tab可以正常切换，数据保存互不影响



✅ 打标签界面清晰，支持多选规则



✅ 保存响应快速(≤2秒)



✅ 提交审核时的检查准确无遗漏

状态流转:





✅ 状态转换规则严格执行



✅ 状态变更后，聚合页统计实时更新



✅ 审核通过后自动归入所有匹配聚合页

6.2 图片管理验收标准

生成功能:





✅ AI生成菜谱时，图片自动异步生成



✅ 单张图片生成时间≤30秒



✅ 生成成功率≥85%



✅ 失败自动重试(最多3次)

重新生成功能:





✅ 点击"重新生成"后30秒内完成



✅ 生成过程可以取消



✅ 生成完成自动替换预览图



✅ 不影响其他图片的展示

Prompt编辑功能:





✅ 可以查看和编辑每张图片的prompt



✅ 修改后的prompt能正确保存



✅ 恢复默认prompt功能正常



✅ 编辑prompt后重新生成的图片符合预期

上传替换功能:





✅ 支持jpg/png/webp格式



✅ 自动检查图片尺寸和比例



✅ 上传成功后立即替换



✅ 标记为"手动上传"，不会被自动重新生成覆盖

批量操作:





✅ 批量重新生成稳定(支持生成10+张图片)



✅ 显示整体进度条



✅ 支持中途取消



✅ 完成后显示统计结果

风格统一:





✅ 所有图片使用全局风格指南



✅ AI风格检查准确率≥80%



✅ 风格不符的图片能正确标记



✅ 重新生成后风格一致性提升



第七部分:数据结构补充

7.1 菜谱表扩展字段

CREATE TABLE recipes (
  id VARCHAR(36) PRIMARY KEY,
  title_zh VARCHAR(255) NOT NULL,
  title_en VARCHAR(255),
  slug VARCHAR(255) UNIQUE NOT NULL,
  
  -- 状态管理
  status ENUM('draft','review','published','archived') DEFAULT 'draft',
  review_status ENUM('pending','approved','rejected') DEFAULT 'pending',
  reviewed_by VARCHAR(36),  -- 审核人ID
  reviewed_at TIMESTAMP,
  published_at TIMESTAMP,
  archived_at TIMESTAMP,
  
  -- 内容(JSON存储完整Schema)
  content JSON NOT NULL,
  
  -- 统计
  view_count INT DEFAULT 0,
  ai_quality_score DECIMAL(3,1),  -- AI质量评分(0-5分)
  
  -- 图片状态追踪
  images_status ENUM('pending','generating','completed','partial_failed','all_failed'),
  images_generated INT DEFAULT 0,  -- 已生成图片数量
  images_total INT DEFAULT 0,  -- 应生成图片总数
  
  -- 来源
  source ENUM('ai_generated','manual','imported') DEFAULT 'ai_generated',
  generation_info JSON,  -- AI生成时的参数记录
  
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

7.2 图片表设计

CREATE TABLE recipe_images (
  id VARCHAR(36) PRIMARY KEY,
  recipe_id VARCHAR(36) NOT NULL,
  
  -- 图片基本信息
  type ENUM('cover_main','cover_detail','cover_inside','ingredients','step') NOT NULL,
  step_id VARCHAR(36),  -- 如果是步骤图，关联步骤ID
  
  -- 文件信息
  url VARCHAR(500) NOT NULL,
  filename VARCHAR(255),
  size INT,  -- 字节
  width INT,
  height INT,
  aspect_ratio VARCHAR(10),  -- 如 "16:9"
  format ENUM('jpg','png','webp') DEFAULT 'jpg',
  
  -- 生成信息
  source ENUM('ai_generated','uploaded') NOT NULL,
  prompt TEXT,  -- 生成时使用的prompt
  negative_prompt TEXT,  -- 反向prompt
  generation_model VARCHAR(100),  -- 如 "dall-e-3"
  generation_params JSON,  -- 生成参数
  
  -- 状态
  status ENUM('pending','generating','success','failed') DEFAULT 'pending',
  error_message TEXT,  -- 失败原因
  retry_count INT DEFAULT 0,  -- 重试次数
  
  -- 质量检查
  style_score INT,  -- 风格符合度(0-100)
  style_issues JSON,  -- AI检测到的风格问题
  manual_approved BOOLEAN DEFAULT FALSE,  -- 人工确认使用
  
  -- 使用统计
  is_active BOOLEAN DEFAULT TRUE,  -- 是否为当前使用的图片
  replaced_by VARCHAR(36),  -- 如果被替换，记录新图片ID
  
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  
  FOREIGN KEY (recipe_id) REFERENCES recipes(id) ON DELETE CASCADE,
  INDEX idx_recipe_type (recipe_id, type),
  INDEX idx_status (status)
);

7.3 图片生成任务表

CREATE TABLE image_generation_tasks (
  id VARCHAR(36) PRIMARY KEY,
  recipe_id VARCHAR(36) NOT NULL,
  image_id VARCHAR(36),  -- 关联到recipe_images
  
  -- 任务信息
  priority ENUM('p0','p1','p2') DEFAULT 'p1',
  type ENUM('cover_main','cover_detail','cover_inside','ingredients','step'),
  prompt TEXT NOT NULL,
  negative_prompt TEXT,
  
  -- 状态
  status ENUM('queued','processing','completed','failed','cancelled') DEFAULT 'queued',
  progress INT DEFAULT 0,  -- 进度百分比
  
  -- 执行信息
  started_at TIMESTAMP,
  completed_at TIMESTAMP,
  duration_sec INT,  -- 执行时长(秒)
  
  -- 结果
  result_image_url VARCHAR(500),
  error_message TEXT,
  retry_count INT DEFAULT 0,
  max_retries INT DEFAULT 3,
  
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (recipe_id) REFERENCES recipes(id) ON DELETE CASCADE,
  INDEX idx_status_priority (status, priority),
  INDEX idx_recipe (recipe_id)
);



第八部分:与现有系统的集成

8.1 与AI生成中心的集成

在AI生成中心(/admin/generate)创建生成任务时:

1. 运营选择生成目标:
   ├─ 选择合集:"糖尿病老人食谱"
   ├─ AI推荐菜谱名称(22个)
   └─ 运营勾选要生成的(如:10个)

2. 点击"开始生成"后:
   ├─ 创建10个菜谱生成任务
   ├─ 每个任务包括:
   │   ├─ 生成菜谱内容(文字)
   │   └─ 生成图片(异步)
   └─ 显示整体进度

3. 菜谱内容生成完成:
   ├─ 菜谱状态:draft
   ├─ 立即创建图片生成任务队列
   └─ 后台异步生成图片

4. 图片生成完成:
   ├─ 更新recipes.images_status
   ├─ 全部成功 → 可提交审核
   └─ 部分失败 → 标记失败项

8.2 与审核工作台的集成

在审核工作台(/admin/review)审核菜谱时:

1. 审核人员进入审核工作台
2. 看到待审核菜谱列表(卡片式)
3. 每个卡片显示:
   ├─ 菜谱标题和标签
   ├─ 成品主图预览
   ├─ AI质量评分
   └─ [快速预览] [详细审核] 按钮

4. 点击"详细审核":
   ├─ 打开抽屉或弹窗
   ├─ 显示完整的内容预览
   │   ├─ 成品图3张(可切换查看)
   │   ├─ 食材列表
   │   ├─ 步骤列表(含步骤图)
   │   └─ 标签
   │
   └─ 图片相关检查:
       ├─ 成品图是否清晰
       ├─ 步骤图是否匹配步骤描述
       └─ 风格是否统一

5. 发现图片问题:
   ├─ 可以直接在审核界面点击"重新生成该图片"
   ├─ 或"拒绝审核"，退回给内容编辑修改
   └─ 或"带问题通过"，发布后再优化

6. 审核通过:
   └─ 菜谱状态改为published

8.3 与合集管理的集成

在合集编辑页查看已匹配菜谱时:

1. 在"内容管理"Tab看到已匹配的菜谱列表
2. 每个菜谱显示:
   ├─ 成品主图缩略图
   ├─ 标题和标签
   ├─ 图片状态指示:
   │   ├─ ✅ 图片完整(9/9)
   │   ├─ ⚠️ 部分失败(8/9) ← 可点击查看详情
   │   └─ ❌ 图片缺失(0/9)
   └─ [编辑] [移除] 按钮

3. 点击"⚠️ 部分失败":
   └─ 跳转到该菜谱的编辑页"图片"Tab



