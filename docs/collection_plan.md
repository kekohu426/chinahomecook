## 一级 / 二级聚合页实施计划 v1.0

### 阶段与验收
- **P1 基础**  
  - 内容：数据库迁移、CRUD、状态机、达标计算；列表/详情 API；slug 生成校验。  
  - 验收：单测通过（达标/状态机），API 契约对齐，迁移可回滚。

- **P2 规则**  
  - 内容：rules API + test 接口 + 规则引擎单测；前端规则编辑器（空规则提示）；实时预览（匹配计数/缺口）。  
  - 验收：规则测试返回正确计数与样本；OR/AND/NOT 单测覆盖；空规则提示。

- **P3 内容管理**  
  - 内容：匹配列表 API/UI，置顶/排除 API/UI，reorder 并发校验；refresh-counts 接口/按钮；缓存与实时口径明确。  
  - 验收：pin/unpin/reorder 幂等；排除生效；刷新后 progress/qualifiedStatus 变化正确。

- **P4 AI**  
  - 内容：recommend 去重已有/排除；generate job/status（最小可用）；失败提示；生成后的状态流（草稿/待审核/自动发布开关）。  
  - 验收：taskId/状态轮询可用；失败兜底提示；不产生重复。

- **P5 SEO**  
  - 内容：SEO API+表单；字数校验；locale 支持；前台预览入口。  
  - 验收：Title/Desc/Keywords 等校验；多语言读写正确。

- **P6 一级聚合配置**  
  - 内容：区块排序/启用/默认折叠；卡片数/门槛；卡片来源=达标集合；前台按配置渲染跳转。  
  - 验收：区块/卡片排序与前台一致；仅达标集合出现；折叠状态生效。

#### 任务拆解示例（可交给 AI 按编号执行）
- P1  
  1.1 数据库迁移（扩展 Collection 字段）  
  1.2 列表页 API（分页、筛选、统计）  
  1.3 列表页 UI（表格、Tab、筛选、分页）  
  1.4 详情/创建 API（GET/POST/PUT /api/admin/collections/[id]）  
  1.5 编辑页框架（左侧导航 + Tab 结构）  
  1.6 基本信息 Tab（表单、封面上传、保存）  
  1.7 统计计算逻辑（匹配数量、进度计算）  
  1.8 发布/状态管理（发布、下架、达标检查）
- P2  
  2.1 单标签规则 API（自动匹配逻辑）  
  2.2 单标签规则 UI（只读展示、统计、跳转）  
  2.3 主题规则 API（OR/AND/NOT 组合查询）  
  2.4 主题规则 UI（规则编辑器组件）  
  2.5 规则测试（实时预览匹配结果）  
  2.6 匹配列表弹窗（查看匹配的食谱）
- P3  
  3.1 置顶 API（pin/unpin/reorder）  
  3.2 置顶 UI（拖拽排序卡片）  
  3.3 食谱列表 API（分页、筛选、排序）  
  3.4 食谱列表 UI（表格、批量操作）  
  3.5 排除功能（排除/取消排除特定食谱）
- P4  
  4.1 AI 推荐 API（基于规则推荐菜名）  
  4.2 AI 推荐 UI（推荐列表、多选）  
  4.3 生成任务 API（创建生成任务、状态查询）  
  4.4 生成任务 UI（设置、进度、结果）
- P5  
  5.1 SEO API（GET/PUT seo 配置）  
  5.2 SEO UI（表单、字数统计、预览）  
  5.3 AI 生成 SEO（标题、描述、文案生成）
- P6  
  6.1 一级区块管理 API/UI（区块启用、排序、折叠、卡片数）  
  6.2 卡片选择源：仅达标集合；支持过滤/搜索/置顶顺序  
  6.3 前台渲染联调：顺序、折叠、跳转正确

### 必要前置（开工前先交付）
1) Collection 最终字段与迁移策略（含旧数据兼容、索引）。  
2) API/类型契约：状态枚举、规则 JSON、SEO JSON、分页/错误格式、locale 透传。  
3) 规则引擎伪代码 + 单测用例列表（OR/AND/NOT、空组、排除、cookTime lte）。  
4) 计数/达标口径：published/pending 是否计入；缓存 vs 实时；刷新策略。  
5) 置顶/排除/排序入参与并发回滚策略。  
6) AI 生成状态流（草稿/待审核/自动发布）、去重、失败兜底格式。  
7) SEO/多语言字段读写约定与字数限制。

### 提交要求（每阶段）
- Diff 摘要 + 契约对齐说明。  
- 已跑测试列表（至少规则引擎/达标、关键 API）。  
- 已知风险/未完成项（明示）。
